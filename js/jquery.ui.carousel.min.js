(function(a,b){a.widget("ui.carousel",{version:0.3,options:{itemsPerPage:1,itemsPerTransition:1,noOfRows:1,horizontal:true,pagination:true,nextPrevActions:true,speed:"normal",easing:"swing",startAt:null,beforeAnimate:null,afterAnimate:null},_create:function(){this.itemIndex=0;this._defineStrings();this._elements();this._setNoOfItems();this._setItemDim();this._setRunnerWidth();this._addMask();this._setLastPos();if(typeof this.options.itemsPerPage!=="number"){this._setItemsPerPage()}this._setNoOfPages();if(this.noOfItems<=this.options.itemsPerPage){return}if(this.options.pagination){this._addPagination()}if(this.options.nextPrevActions){this._addNextPrevActions()}if(this.options.startAt!==null){this.goTo(this.options.startAt)}this._updateUi()},_defineStrings:function(){if(this.options.horizontal){this.positionStr="left";this.dimensionStr="width"}else{this.positionStr="top";this.dimensionStr="height"}},_elements:function(){var c=this.elements={};c.container=this.element;c.runner=c.container.find("ul");c.items=c.runner.children("li");c.mask=c.container.find(".mask");c.pagination=null;c.nextAction=null;c.prevAction=null},_setNoOfItems:function(){this.noOfItems=Math.ceil(this.elements.items.length/this.options.noOfRows)},_setItemDim:function(){this.itemDim=this.elements.items["outer"+this.dimensionStr.charAt(0).toUpperCase()+this.dimensionStr.slice(1)](true);console.log(this.itemDim)},_setRunnerWidth:function(){if(this.options.horizontal){var c=this.itemDim*this.noOfItems;this.elements.runner.width(c)}},_addMask:function(){var c=this.elements;if(!c.mask.length){c.mask=c.runner.wrap('<div class="mask" />').parent();this.maskAdded=true}this._setMaskDim();if(this.options.horizontal){var d=c.runner.outerHeight(true);c.mask.height(d)}},_setMaskDim:function(){this.maskDim=this.elements.mask[this.dimensionStr]()},_setLastPos:function(){this.lastPos=this.elements.items.last().position()[this.positionStr]+this.itemDim-this.maskDim-parseInt(this.elements.items.last().css("margin-right"),10)},_setItemsPerPage:function(){this.options.itemsPerPage=Math.floor(this.maskDim/this.itemDim)},_setNoOfPages:function(){this.noOfPages=Math.ceil((this.noOfItems-this.options.itemsPerPage)/this.options.itemsPerTransition)+1},_addPagination:function(){var d=this,c=[],e;for(e=0;e<this.noOfPages;e++){c[e]='<li><a href="#item-'+e+'">'+(e+1)+"</a></li>"}this.elements.pagination=a('<ol class="pagination-links" />').insertAfter(this.elements.mask).append(c.join("")).delegate("a","click.carousel",function(){d.goTo(a(this).parent().index()*d.options.itemsPerTransition);return false})},_refreshPagination:function(){this.elements.pagination.remove();this._setNoOfPages();this._addPagination();this._updateUi()},_addNextPrevActions:function(){var d=this,c=this.elements;c.prevAction=a('<a href="#" class="prev">Prev</a>').appendTo(c.container);c.nextAction=a('<a href="#" class="next">Next</a>').appendTo(c.container);c.nextAction.bind("click.carousel",function(){d.next();return false});c.prevAction.bind("click.carousel",function(){d.prev();return false})},next:function(){this.itemIndex=this.itemIndex+this.options.itemsPerTransition;this._go()},prev:function(){this.itemIndex=this.itemIndex-this.options.itemsPerTransition;this._go()},_updateUi:function(){var c=this.elements,d=this.itemIndex;if(this.options.pagination){c.pagination.children("li").removeClass("current").eq(Math.ceil(d/this.options.itemsPerTransition)).addClass("current")}if(this.options.nextPrevActions){c.nextAction.add(c.prevAction).removeClass("disabled");if(d===(this.noOfItems-this.options.itemsPerPage)){c.nextAction.addClass("disabled")}else{if(d===0){c.prevAction.addClass("disabled")}}}},addItems:function(d){var c=this.elements;d.appendTo(c.runner);c.items=c.runner.children("li");this._setNoOfItems();this._setRunnerWidth();this._setLastPos();this._refreshPagination()},goTo:function(c){if(typeof c==="number"){this.itemIndex=c}else{this.itemIndex=a(c).index()}this._go()},_go:function(){var e=this,d=this.elements,c;if(this.itemIndex>(this.noOfItems-this.options.itemsPerPage)){this.itemIndex=this.noOfItems-this.options.itemsPerPage}if(this.itemIndex<0){this.itemIndex=0}c=d.items.eq(this.itemIndex);this._trigger("beforeAnimate",null,{index:this.itemIndex});this._slide(c);this._updateUi()},_slide:function(c){var f=this,e=this.elements,g=c.position(),d={};if(Math.abs(g[this.positionStr])>=this.lastPos){g[this.positionStr]=this.lastPos}d[this.positionStr]=-g[this.positionStr];e.runner.stop().animate(d,this.options.speed,this.options.easing,function(){f._trigger("afterAnimate",null,{index:f.itemIndex})})},_setOption:function(d,f){var c=this.elements,e=this.options;a.Widget.prototype._setOption.apply(this,arguments);switch(d){case"itemsPerPage":this._setMaskDim();this._setLastPos();this._refreshPagination();break;case"itemsPerTransition":this._refreshPagination();break;case"noOfRows":if(this.options.horizontal){this._setNoOfItems();this._setRunnerWidth();this._setLastPos();this._refreshPagination()}break;case"pagination":if(f&&!c.pagination){this._addPagination();this._updateUi()}else{if(!f&&c.pagination){c.pagination.remove();c.pagination=null}}break;case"nextPrevActions":if(f&&!c.nextAction){this._addNextPrevActions();this._updateUi()}else{if(!f&&c.nextAction){c.nextAction.remove();c.nextAction=null;c.prevAction.remove();c.prevAction=null}}break}},destroy:function(){var c=this.elements,d={};d[this.positionStr]="auto";d[this.dimensionStr]="auto";if(maskAdded in this){c.runner.unwrap(".mask")}c.runner.css(d);c.pagination.remove();c.nextAction.remove();c.prevAction.remove();a.each(c,function(){a(this).unbind(".carousel")});a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);