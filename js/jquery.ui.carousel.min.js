(function(a,b){a.widget("ui.carousel",{version:0.5,oldClass:null,options:{itemsPerPage:4,itemsPerTransition:4,orientation:"horizontal",noOfRows:1,unknownHeight:true,pagination:true,nextPrevActions:true,speed:"normal",easing:"swing",startAt:null,beforeAnimate:null,afterAnimate:null},_create:function(){this.itemIndex=0;this._elements();this._addClasses();this._defineOrientation();this._addMask();this._setMaskDim();this._setItemDim();this._setItemsPerPage();this._setNoOfItems();this._setNoOfPages();this._setRunnerWidth();this._setMaskHeight();this._setLastPos();this._addPagination();this._addNextPrevActions();if(this.options.startAt){this.goTo(this.options.startAt)}this._updateUi()},_elements:function(){var c=this.elements={};c.mask=this.element.find(".mask");c.runner=this.element.find("ul");c.items=c.runner.children("li");c.pagination=null;c.nextAction=null;c.prevAction=null},_addClasses:function(){this.oldClass=this.element.attr("class");this._removeClasses();var d=this.widgetBaseClass,c=[];c.push(d);c.push(d+"-"+this.options.orientation);c.push(d+"-items-"+this.options.itemsPerPage);c.push(d+"-rows-"+this.options.noOfRows);this.element.addClass(c.join(" "))},_removeClasses:function(){var d=[],e,c;this.element.removeClass(function(g,f){f=f.split(" ");a.each(f,function(h){e=f[h];c=e.split("-");if(c[0]==="ui"&&c[1]==="carousel"){d.push(e)}});return d.join(" ")})},_defineOrientation:function(){if(this.options.orientation==="horizontal"){this.horizontal=true;this.helperStr={pos:"left",pos2:"right",dim:"width"}}else{this.horizontal=false;this.helperStr={pos:"top",pos2:"bottom",dim:"height"};this.options.noOfRows=1}},_addMask:function(){var c=this.elements;if(c.mask.length){return}c.mask=c.runner.wrap('<div class="mask" />').parent();this.maskAdded=true},_setMaskDim:function(){this.maskDim=this.elements.mask[this.helperStr.dim]()},_setMaskHeight:function(){if(!this.horizontal||!this.options.unknownHeight){return}var c=this.elements,d=c.runner.outerHeight(true);c.mask.height(d)},_setItemDim:function(){this.itemDim=this.elements.items["outer"+this.helperStr.dim.charAt(0).toUpperCase()+this.helperStr.dim.slice(1)](true)},_setItemsPerPage:function(){if(typeof this.options.itemsPerPage==="number"){return}this.options.itemsPerPage=Math.floor(this.maskDim/this.itemDim)},_setNoOfItems:function(){this.noOfItems=Math.ceil(this.elements.items.length/this.options.noOfRows);if(this.noOfItems<this.options.itemsPerPage){this.noOfItems=this.options.itemsPerPage}},_setNoOfPages:function(){this.noOfPages=Math.ceil((this.noOfItems-this.options.itemsPerPage)/this.options.itemsPerTransition)+1},_setRunnerWidth:function(){if(!this.horizontal){return}var c=this.itemDim*this.noOfItems;this.elements.runner.width(c)},_setLastPos:function(){var c=this.elements.items.eq(this.noOfItems-1);this.lastPos=c.position()[this.helperStr.pos]+this.itemDim-this.maskDim-parseInt(c.css("margin-"+this.helperStr.pos2),10)},_addPagination:function(){if(!this.options.pagination){return}var d=this,c=[],e;for(e=0;e<this.noOfPages;e++){c[e]='<li><a href="#item-'+e+'">'+(e+1)+"</a></li>"}this.elements.pagination=a('<ol class="pagination-links" />').insertAfter(this.elements.mask).append(c.join("")).delegate("a","click.carousel",function(){d.goTo(this.hash.split("-")[1]*d.options.itemsPerTransition);return false})},_refreshPagination:function(){if(!this.options.pagination){return}this.elements.pagination.remove();this._setNoOfPages();this._addPagination()},goTo:function(c){if(typeof c==="number"){this.itemIndex=c}else{this.itemIndex=a(c).index()}this._go()},_addNextPrevActions:function(){if(!this.options.nextPrevActions){return}var d=this,c=this.elements;c.prevAction=a('<a href="#" class="prev">Prev</a>').appendTo(this.element);c.nextAction=a('<a href="#" class="next">Next</a>').appendTo(this.element);c.nextAction.bind("click.carousel",function(){d.next();return false});c.prevAction.bind("click.carousel",function(){d.prev();return false})},next:function(){this.itemIndex=this.itemIndex+parseInt(this.options.itemsPerTransition,10);this._go()},prev:function(){this.itemIndex=this.itemIndex-this.options.itemsPerTransition;this._go()},_updateUi:function(){var d=this.elements,e=this.itemIndex,f=this.noOfItems<=this.options.itemsPerPage;if(this.options.pagination){if(f){d.pagination.addClass("void")}else{d.pagination.children("li").removeClass("current").eq(Math.ceil(e/this.options.itemsPerTransition)).addClass("current")}}if(this.options.nextPrevActions){var c=d.nextAction.add(d.prevAction);c.removeClass("disabled");if(f){c.addClass("void")}else{c.removeClass("void");if(e===(this.noOfItems-this.options.itemsPerPage)){d.nextAction.addClass("disabled")}else{if(e===0){d.prevAction.addClass("disabled")}}}}},_go:function(){var d=this.elements,c;if(this.itemIndex>(this.noOfItems-this.options.itemsPerPage)){this.itemIndex=this.noOfItems-this.options.itemsPerPage}if(this.itemIndex<0){this.itemIndex=0}c=d.items.eq(this.itemIndex);this._trigger("beforeAnimate",null,{index:this.itemIndex});this._slide(c);this._updateUi()},_slide:function(c){var f=this,e=this.elements,g=c.position(),d={};if(Math.abs(g[this.helperStr.pos])>this.lastPos){g[this.helperStr.pos]=this.lastPos}d[this.helperStr.pos]=-g[this.helperStr.pos];e.runner.stop().animate(d,this.options.speed,this.options.easing,function(){f._trigger("afterAnimate",null,{index:f.itemIndex})})},_refresh:function(){this.itemIndex=0;this.elements.runner.css({left:"",top:""});this._addClasses();this._setMaskDim();this._setItemDim();this._setItemsPerPage();this._setNoOfItems();this._setRunnerWidth();this._setMaskHeight();this._setLastPos();this._refreshPagination();this._updateUi()},addItems:function(d){var c=this.elements;d.appendTo(c.runner);c.items=c.runner.children("li");this._refresh()},_setOption:function(d,f){var c=this.elements,e=this.options;a.Widget.prototype._setOption.apply(this,arguments);switch(d){case"itemsPerPage":this._refresh();break;case"itemsPerTransition":this._refreshPagination();this._updateUi();break;case"noOfRows":if(this.horizontal){this._refresh()}else{e.noOfRows=1}break;case"unknownHeight":if(f){this._setMaskHeight()}else{c.mask.height("")}break;case"orientation":this._defineOrientation();c.mask.height("");c.runner.width("");this._refresh();break;case"pagination":if(f&&!c.pagination){this._addPagination();this._updateUi()}else{if(!f&&c.pagination){c.pagination.remove();c.pagination=null}}break;case"nextPrevActions":if(f&&!c.nextAction){this._addNextPrevActions();this._updateUi()}else{if(!f&&c.nextAction){c.nextAction.remove();c.nextAction=null;c.prevAction.remove();c.prevAction=null}}break}},destroy:function(){var c=this.elements,d={};this.element.removeClass().addClass(this.oldClass);if("maskAdded" in this){c.runner.unwrap(".mask")}else{c.mask.height("")}d[this.helperStr.pos]="";d[this.helperStr.dim]="";c.runner.css(d);if(c.pagination){c.pagination.remove()}if(c.nextAction){c.nextAction.remove();c.prevAction.remove()}a.each(c,function(){a(this).unbind(".carousel")});a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);